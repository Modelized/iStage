<!DOCTYPE html>
<html lang='en'>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>iStage</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="../assets/css/style.css">
</head>
<body>
<nav class="nav" role="navigation" aria-label="Primary">
  <div class="nav-inner">
    <div class="container row">
      <a class="brand" href="../" aria-label="iStage">
        <img class="brand-logo" src="../assets/img/logo.png" alt="" loading="eager" decoding="async">
        <span class="brand-text">iStage</span>
      </a>
      <ul class="menu desktop">
        <li><a href="../iStage-26/">iStage 26</a></li>
        <li><a href="../iStage-18/">iStage 18</a></li>
        <li><a href="../compare/">Compare</a></li>
        <li><a href="../releases/">Releases</a></li>
        <li><a href="../help/">Help</a></li>
        <li><a href="../gallery/">Gallery</a></li>
      </ul>
      <button class="nav-toggle" aria-label="Open menu" aria-expanded="false" aria-controls="mobile-sheet">
        <span class="nav-toggle-bar"></span>
      </button>
    </div>
    <div class="container sheet" id="mobile-sheet" aria-hidden="true">
      <div class="sheet-content">
        <ul class="mobile-menu">
          <li><a href="../iStage-26/">iStage 26</a></li>
          <li><a href="../iStage-18/">iStage 18</a></li>
          <li><a href="../compare/">Compare</a></li>
          <li><a href="../releases/">Releases</a></li>
          <li><a href="../help/">Help</a></li>
          <li><a href="../gallery/">Gallery</a></li>
        </ul>
      </div>
    </div>
  </div>
</nav>
<main class="container">
  <section class="section section--white">
    <div class="hero copy">
      <h1 class="title" style="margin-bottom:6px">Releases</h1>
      <p class="subtitle small">Latest changes and downloads.</p>
    </div>
    <div class="releases-list" id="releases-list"></div>
  </section>
</main>
<footer class="footer">
  <div class="container small muted">© <span id="year"></span> iStage. Not affiliated with Apple Inc.</div>
  <script>document.getElementById('year').textContent = new Date().getFullYear();</script>
  <script>
    const nav = document.querySelector('.nav');
    const toggle = document.querySelector('.nav-toggle');
    const sheet  = document.getElementById('mobile-sheet');
    const body   = document.body;
    if (toggle && sheet) {
      toggle.addEventListener('click', () => {
        const open = nav.classList.toggle('nav--open');
        toggle.setAttribute('aria-expanded', open ? 'true' : 'false');
        sheet.setAttribute('aria-hidden', open ? 'false' : 'true');
        body.classList.toggle('no-scroll', open);
      });
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape' && nav.classList.contains('nav--open')) {
          nav.classList.remove('nav--open');
          toggle.setAttribute('aria-expanded','false');
          sheet.setAttribute('aria-hidden','true');
          body.classList.remove('no-scroll');
        }
      });
    }
    const brand = document.querySelector('.brand');
    const logo  = document.querySelector('.brand-logo');
    const txt   = document.querySelector('.brand-text');
    function update(){ if(brand&&logo&&txt && logo.naturalWidth>0){ brand.classList.add('has-logo'); } }
    if (logo){ if (logo.complete) update(); logo.addEventListener('load', update); logo.addEventListener('error', ()=>brand&&brand.classList.remove('has-logo')); }
  </script>
  <script>
/* ---- Releases renderer (GitHub API) ---- */
(function(){
  const OWNER = 'Modelized';
  const REPO  = 'iStage';
  const list  = document.getElementById('releases-list');
  if (!list) return;

  const fmtDate = iso => {
    try{
      const d = new Date(iso);
      return d.toLocaleDateString(undefined, { year:'numeric', month:'short', day:'numeric' });
    }catch(_){ return iso || ''; }
  };
  const fmtSize = bytes => {
    if (bytes == null) return '';
    const units = ['B','KB','MB','GB'];
    let i = 0, n = bytes;
    while (n >= 1024 && i < units.length-1){ n/=1024; i++; }
    return `${n.toFixed(n < 10 && i>0 ? 1 : 0)} ${units[i]}`;
  };
  const stripImages = md => (md||'')
    // remove markdown images ![alt](url)
    .replace(/!\[[^\]]*]\([^)]*\)/g, '')
    // remove html <img ...> tags
    .replace(/<img[\s\S]*?>/gi, '')
    .trim();

  const mdToHtml = md => {
    // very small markdown-to-HTML for bullets and newlines
    const text = stripImages(md);
    const lines = text.split(/\r?\n/);
    const out = [];
    let inList = false;
    for (const line of lines){
      if (/^\s*[-*]\s+/.test(line)){
        if (!inList){ out.push('<ul>'); inList = true; }
        out.push(`<li>${line.replace(/^\s*[-*]\s+/, '')}</li>`);
      }else{
        if (inList){ out.push('</ul>'); inList = false; }
        if (line.trim()) out.push(`<p>${line}</p>`);
      }
    }
    if (inList) out.push('</ul>');
    return out.join('');
  };

  const tpl = (r) => {
    const title = r.name || r.tag_name || 'Untitled';
    const tag   = r.tag_name ? ` • ${r.tag_name}` : '';
    const date  = r.published_at ? fmtDate(r.published_at) : '';
    const asset = (r.assets||[]).find(a => /\.klck$/i.test(a.name)) || (r.assets||[])[0];
    const size  = asset ? fmtSize(asset.size) : '';
    const href  = asset ? asset.browser_download_url : r.html_url;

    return `
      <article class="card">
        <header class="release-head">
          <div>
            <h2 class="title" style="margin:0 0 4px">${title}</h2>
            <div class="muted small">${date}${tag}</div>
          </div>
          <div>
            <a class="btn btn-outline" href="${href}" ${asset ? 'download' : ''}>Download</a>
            ${size ? `<span class="small muted" style="margin-left:.6rem">${size}</span>` : ''}
          </div>
        </header>
        <div class="prose" style="margin-top:12px">${mdToHtml(r.body)}</div>
      </article>
    `;
  };

  const showError = (msg) => {
    list.innerHTML = `
      <div class="card" role="alert">
        <strong>Failed to load releases.</strong><br />
        <span class="small muted">${msg}</span>
      </div>`;
  };

  fetch(`https://api.github.com/repos/${OWNER}/${REPO}/releases`, {
    headers: { 'Accept': 'application/vnd.github+json' }
  })
  .then(r => r.ok ? r.json() : Promise.reject(`${r.status} ${r.statusText}`))
  .then(items => {
    if (!Array.isArray(items) || !items.length){ showError('No releases found.'); return; }
    list.innerHTML = items.map(tpl).join('');
  })
  .catch(err => showError(String(err)));
})();
  </script>
</footer>
</body>
</html>