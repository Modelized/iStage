<!DOCTYPE html>
<html lang='en'>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>iStage</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="../assets/css/style.css">
</head>
<body>
<nav class="nav" role="navigation" aria-label="Primary">
  <div class="nav-inner">
    <div class="container row">
      <a class="brand" href="../" aria-label="iStage">
        <img class="brand-logo" src="../assets/img/logo.png" alt="" loading="eager" decoding="async">
        <span class="brand-text">iStage</span>
      </a>
      <ul class="menu desktop">
        <li><a href="../iStage-26/">iStage 26</a></li>
        <li><a href="../iStage-18/">iStage 18</a></li>
        <li><a href="../compare/">Compare</a></li>
        <li><a href="../releases/">Releases</a></li>
        <li><a href="../help/">Help</a></li>
        <li><a href="../gallery/">Gallery</a></li>
      </ul>
      <button class="nav-toggle" aria-label="Open menu" aria-expanded="false" aria-controls="mobile-sheet">
        <span class="nav-toggle-bar"></span>
      </button>
    </div>
    <div class="container sheet" id="mobile-sheet" aria-hidden="true">
      <div class="sheet-content">
        <ul class="mobile-menu">
          <li><a href="../iStage-26/">iStage 26</a></li>
          <li><a href="../iStage-18/">iStage 18</a></li>
          <li><a href="../compare/">Compare</a></li>
          <li><a href="../releases/">Releases</a></li>
          <li><a href="../help/">Help</a></li>
          <li><a href="../gallery/">Gallery</a></li>
        </ul>
      </div>
    </div>
  </div>
</nav>
<main class="container prose">
  <h1>Releases</h1>
  <div class="version-tabs-wrap" id="version-tabs-wrap" hidden>
    <div class="version-tabs-shell">
      <button class="chev chev--prev" id="ver-prev" aria-label="Previous versions" hidden>‹</button>
      <div class="version-tabs" id="version-tabs" role="tablist" aria-label="iStage versions">
        <div class="version-thumb" id="version-thumb" aria-hidden="true"></div>
      </div>
      <button class="chev chev--next" id="ver-next" aria-label="Next versions" hidden>›</button>
    </div>
  </div>
  <div id="releases" class="releases-list">
    <div class="card"><p class="muted">Loading releases…</p></div>
  </div>
  <template id="release-tpl">
    <article class="card release" data-major="">
      <header class="release-head"><h2 class="release-title"></h2><span class="tag"></span></header>
      <p class="release-meta muted"></p>
      <div class="release-body"></div>
      <div class="assets"></div>
    </article>
  </template>
</main>
<script>
const GH_OWNER="Modelized", GH_REPO="iStage";
const API=`https://api.github.com/repos/${GH_OWNER}/${GH_REPO}/releases`;
const majorOf=(t)=>{const m=String(t||"").match(/v?(\d+)(?:[._-]|$)/i);return m?parseInt(m[1],10):null};
const listEl=document.getElementById('releases'), tabsWrap=document.getElementById('version-tabs-wrap'), tabsEl=document.getElementById('version-tabs'), thumbEl=document.getElementById('version-thumb');
const btnPrev=document.getElementById('ver-prev'), btnNext=document.getElementById('ver-next');
let MAJORS=[], windowStart=0, currentMajor=null;
const mdLite=(md)=>(md||'—').replace(/^### (.*$)/gim,'<h3>$1</h3>').replace(/^## (.*$)/gim,'<h2>$1</h2>').replace(/^# (.*$)/gim,'<h1>$1</h1>').replace(/\*\*(.*?)\*\*/gim,'<strong>$1</strong>').replace(/\*(.*?)\*/gim,'<em>$1</em>').replace(/`([^`]+)`/g,'<code>$1</code>').replace(/^[-*] (.*$)/gim,'<li>$1</li>').replace(/\n\n/g,'</p><p>').replace(/\n/g,'<br>');
function renderRelease(rel){const tpl=document.getElementById('release-tpl'); const node=tpl.content.cloneNode(true); const major=majorOf(rel.tag_name);
 node.querySelector('.release-title').textContent=rel.name||rel.tag_name; node.querySelector('.tag').textContent=rel.prerelease?'Pre-release':(rel.draft?'Draft':'Release');
 const d=new Date(rel.published_at||rel.created_at); node.querySelector('.release-meta').textContent=`${rel.tag_name} • ${d.toLocaleDateString(undefined,{year:'numeric',month:'short',day:'numeric'})}`;
 node.querySelector('.release-body').innerHTML='<h3>Changelog</h3><p>'+mdLite(rel.body)+'</p>';
 const assets=node.querySelector('.assets'); if(rel.assets&&rel.assets.length){const ul=document.createElement('ul'); rel.assets.forEach(a=>{const li=document.createElement('li'); const link=document.createElement('a'); link.href=a.browser_download_url; link.textContent=a.name+(a.size?` (${Math.round(a.size/1024)} KB)`:''); link.rel='noopener'; link.target='_blank'; li.appendChild(link); ul.appendChild(li);}); assets.appendChild(ul);} else {assets.innerHTML='<p class="muted">No assets</p>';}
 node.querySelector('article').dataset.major=major; return node;}
function mountList(d){listEl.innerHTML=''; d.forEach(r=>listEl.appendChild(renderRelease(r)));}
function filterByMajor(m){Array.from(listEl.children).forEach(c=>c.style.display=(String(c.dataset.major)===String(m))?'':'none');}
function animateThumbTo(target){if(!target)return; const r=target.getBoundingClientRect(), host=tabsEl.getBoundingClientRect(); thumbEl.style.width=r.width+'px'; thumbEl.style.transform=`translateX(${r.left-host.left}px)`;}
function selectMajor(m,btn,animate=true){currentMajor=m; Array.from(tabsEl.querySelectorAll('.tab')).forEach(t=>t.setAttribute('aria-selected',String(t.dataset.major)===String(m)?'true':'false')); filterByMajor(m); if(animate){requestAnimationFrame(()=>animateThumbTo(btn||tabsEl.querySelector('.tab[aria-selected="true"]')));} else {animateThumbTo(btn||tabsEl.querySelector('.tab[aria-selected="true"]'));}}
function updateChevronVisibility(){const narrow=window.matchMedia('(max-width:520px)').matches; const many=MAJORS.length>2; btnPrev.hidden=!(narrow&&many); btnNext.hidden=!(narrow&&many); tabsEl.classList.toggle('viewported',narrow&&many);}
function applyWindow(){const vp=tabsEl.classList.contains('viewported'); const tabs=Array.from(tabsEl.querySelectorAll('.tab')); if(!vp){tabs.forEach(t=>t.hidden=false); return;} tabs.forEach((t,i)=>t.hidden=!(i===windowStart||i===windowStart+1));}
function shiftWindow(dir){const maxStart=Math.max(0,MAJORS.length-2); windowStart=Math.min(maxStart,Math.max(0,windowStart+dir)); applyWindow(); const m=(dir>0)?MAJORS[Math.min(MAJORS.length-1,windowStart+1)]:MAJORS[windowStart]; const btn=tabsEl.querySelector(`.tab[data-major="${m}"]`); selectMajor(m,btn);}
btnPrev.addEventListener('click',()=>shiftWindow(-1)); btnNext.addEventListener('click',()=>shiftWindow(1));
window.addEventListener('resize',()=>{updateChevronVisibility(); applyWindow(); animateThumbTo(tabsEl.querySelector('.tab[aria-selected="true"]'));});
function buildTabs(majors){tabsEl.querySelectorAll('button.tab').forEach(b=>b.remove()); majors.forEach(m=>{const b=document.createElement('button'); b.className='tab'; b.type='button'; b.dataset.major=m; b.setAttribute('role','tab'); b.setAttribute('aria-selected','false'); b.textContent=`iStage ${m}`; b.addEventListener('click',()=>selectMajor(m,b)); tabsEl.appendChild(b);}); updateChevronVisibility(); applyWindow();}
function desiredFromURL(){const u=new URL(location.href); const qs=u.searchParams.get('v'); const hs=(u.hash||'').match(/v=(\d+)/i); const num=qs||(hs?hs[1]:null); return num?parseInt(num,10):null;}
async function init(){try{const res=await fetch(API,{headers:{'Accept':'application/vnd.github+json'}}); if(!res.ok) throw new Error('GitHub API error: '+res.status); const data=await res.json(); if(!Array.isArray(data)||!data.length){listEl.innerHTML='<div class="card"><p class="muted">No releases yet.</p></div>'; return;} mountList(data); MAJORS=Array.from(new Set(data.map(r=>majorOf(r.tag_name)).filter(Boolean))).sort((a,b)=>b-a); const want=desiredFromURL(); if(MAJORS.length>=2){tabsWrap.hidden=false; buildTabs(MAJORS);} const initial=(want&&MAJORS.includes(want))?want:(MAJORS[0]||null); if(initial){const btn=tabsEl.querySelector(`.tab[data-major="${initial}"]`); selectMajor(initial,btn,false);} }catch(e){ listEl.innerHTML='<div class="card"><p class="muted">Failed to load releases. Visit the <a target="_blank" rel="noopener">GitHub Releases page</a>.</p></div>'; const a=listEl.querySelector('a'); if(a) a.href='https://github.com/'+GH_OWNER+'/'+GH_REPO+'/releases'; console.error(e);}}
init();
</script>
<footer class="footer">
  <div class="container small muted">© <span id="year"></span> iStage. Not affiliated with Apple Inc.</div>
  <script>document.getElementById('year').textContent = new Date().getFullYear();</script>
  <script>
    const nav = document.querySelector('.nav');
    const toggle = document.querySelector('.nav-toggle');
    const sheet  = document.getElementById('mobile-sheet');
    const body   = document.body;
    if (toggle && sheet) {
      toggle.addEventListener('click', () => {
        const open = nav.classList.toggle('nav--open');
        toggle.setAttribute('aria-expanded', open ? 'true' : 'false');
        sheet.setAttribute('aria-hidden', open ? 'false' : 'true');
        body.classList.toggle('no-scroll', open);
      });
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape' && nav.classList.contains('nav--open')) {
          nav.classList.remove('nav--open');
          toggle.setAttribute('aria-expanded','false');
          sheet.setAttribute('aria-hidden','true');
          body.classList.remove('no-scroll');
        }
      });
    }
    // Brand logo fallback: logo-only when it loads; show text only if it fails
    const brand = document.querySelector('.brand');
    const logo  = document.querySelector('.brand-logo');
    const txt   = document.querySelector('.brand-text');
    function update(){ if(brand&&logo&&txt && logo.naturalWidth>0){ brand.classList.add('has-logo'); } }
    if (logo){ if (logo.complete) update(); logo.addEventListener('load', update); logo.addEventListener('error', ()=>brand&&brand.classList.remove('has-logo')); }
  </script>
</footer>
</body>
</html>